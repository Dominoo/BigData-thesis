% options:
% thesis=B bachelor's thesis
% thesis=M master's thesis
% czech thesis in Czech language
% slovak thesis in Slovak language
% english thesis in English language
% hidelinks remove colour boxes around hyperlinks

\documentclass[thesis=M,czech]{FITthesis}[2012/06/26]

\usepackage[utf8]{inputenc} % LaTeX source encoded as UTF-8

%\usepackage{color}
\usepackage{graphicx} %graphics files inclusion
\usepackage{amsmath} %advanced maths
\usepackage{amssymb} %additional math symbols
\usepackage{listings}
%\usepackage[x11names]{xcolor}

\usepackage{caption}

%\usepackage{graphicx} %graphics files inclusion
% \usepackage{amsmath} %advanced maths
% \usepackage{amssymb} %additional math symbols
\usepackage{wrapfig}
\usepackage{tabularx}
%\usepackage{float}
%\restylefloat{table}

\usepackage{dirtree} %directory tree visualisation

%\usepackage{xcolor}
%\usepackage{color}
%%\usepackage{listings}

%\definecolor{dkgreen}{rgb}{0,0.6,0}
%\definecolor{gray}{rgb}{0.5,0.5,0.5}
%\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=SQL,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
%  numberstyle=\tiny\color{gray},
 % keywordstyle=\color{blue},
%  commentstyle=\color{dkgreen},
 % stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}

% % list of acronyms
% \usepackage[acronym,nonumberlist,toc,numberedsection=autolabel]{glossaries}
% \iflanguage{czech}{\renewcommand*{\acronymname}{Seznam pou{\v z}it{\' y}ch zkratek}}{}
% \makeglossaries

\newcommand{\tg}{\mathop{\mathrm{tg}}} %cesky tangens
\newcommand{\cotg}{\mathop{\mathrm{cotg}}} %cesky cotangens

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
% ODTUD DAL VSE ZMENTE
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

\department{Katedra Softwarového inženýrství}
\title{Distribuované ukládání a zpracování velkého množství dat - případové studie}
\authorGN{Dominik} %(křestní) jméno (jména) autora
\authorFN{Veselý} %příjmení autora
\authorWithDegrees{Bc. Dominik Veselý} %jméno autora včetně současných akademických titulů
\supervisor{Ing. Michal Valenta, PhD}	
\acknowledgements{Chtěl bych poděkovat vedoucímu práce za podnětné, připomínky při tvorbě této práce za příležitost, si toto téma zvolit. Dále bych chtěl poděkovat rodičům za podporu po celou dobu studia. Nakonec bych poděkoval kolegovi Bc. Štěpánovi Hellerovi za finální korekturu mého textu.}
\abstractCS{Tato práce shrnuje a definuje celý koncept BigData a jeho historii. Zabývá se také popisem technik, které jsou s tímto konceptem svázány, včetně vývoje pohledu na CAP theorém, který je nejznámějším theorémem spojeným s moderními distribuovanými systémy. V další části se práce zaměřuje na popis opensource technologií a to zejména Apache BigData platform. Největší důraz je kladen na NoSQL databázi Cassandru, která je v této práci stěžejní. Poslední část se zabývá reálnými případy užití Cassandry a přidružených technologií v praxi a popisem tvorby některých vybraných případů, které poslouží v rámci výuky v nově připravovaném předmětu. }
\abstractEN{This thesis sums up the whole concept of BigData and its history. It also describes techniques tightly related with this concept including evolution of how engineers look on CAP theorem which happens to be one of the biggest rules in modern distributed computing. In the next part thesis focus on opensource software from Apache BigData platform. It looks under the hood of NoSQL database Cassandra which is primary software for this thesis. Last part describes real use cases of Cassandra and related technologies in real world examples and description creation of certain use cases whose will be used in newly prepared course. }
\placeForDeclarationOfAuthenticity{V~Praze}
\declarationOfAuthenticityOption{4} %volba Prohlášení (číslo 1-6)
\keywordsCS{BigData, MapReduce, NoSQL, Cassandra, Sparse Collumn Database}
\keywordsEN{BigData, MapReduce, NoSQL, Cassandra, Sparse Collumn Database}


\begin{document}
	
% \newacronym{CVUT}{{\v C}VUT}{{\v C}esk{\' e} vysok{\' e} u{\v c}en{\' i} technick{\' e} v Praze}
% \newacronym{FIT}{FIT}{Fakulta informa{\v c}n{\' i}ch technologi{\' i}}

\begin{introduction}

\input{introduction.tex}


\end{introduction}


\chapter{Co jsou to BigData}

\input{chapter2.tex}


%mozna jen podsekce bigdata%
\chapter{BigData techniky}

\input{chapter3.tex}

\chapter{BigData Platforma Apache}

\input{chapter4.tex}

\chapter{Cassandra}	

\input{chapter5.tex}


\chapter{Vhodné případy užití}
\input{chapter6.tex}

\section{Dotazování nad daty s dvojsměrnou vazbou}
Další možností případu užití je ukládání informací o uskutečněných transkacích. Kdy po každé transakci ukládáme který uživatel si koupil jaký předmět. Tyto informace pro nás mají velkou informační hodnotu, protože nás může zajímat, kterí uživatelé si koupili konkrétní předmět, nebo také jaké předměty si koupil konkrétní uživatel. V malém elektronickém obchodě, který má pár desítek předmětů a pár set uživatelů takovéto informace můžeme ukládat klasickým způsobem do relační databáze, která takovýto obnos dat zvládne. V případě, že máme několik desítek tisíc uživatelů a v podstatě neomezený sortiment zboží a denně děláme několik stovek tisic transakcí, dostáváme se do objemu dat, na který relační databáze nestačí a musíme použít nějaký NoSQL nástroj. Tento příklad užití by měl poukázat na to, že přestože je zadání velice triviální a jednoduše řešitelné pomocí relačních databází, tak při určitém objemu dat, se problém stává velice komplikovaný a musí se řešit pomocí komplexnějších nástrojů

\begin{lstlisting}[caption={Vytvoření tabulky s dvojsměrnou vazbou pomocí indexu},label=CQL10]
CREATE TABLE itemstracking ( 
item text,
user text,
timestamp timestamp,
PRIMARY KEY (item)
);

CREATE INDEX userIndex ON itemstracking (user);
\end{lstlisting}

CQL neumí dotazování na sloupce mimo primární klíč, k tomu Cassandra využívá sekundární indexy. Po přídání indexu může CQL dotaz obsahovat filtrování podle sloupce \emph{item} nebo \emph{user}. Přestože se nyní můžeme dotazovat díky indexu i na položky uživatele v dokumentaci cassandry \cite{cassaindex} se dočteme, že používání indexů na sloupce s velkou kardinalitou není vhodné vzhledem k implementaci. Kdybychom měli velice omezený seznam uživatelů nebo předmětů, mohli bychom tabulku vymodelovat pomocí indexu, toto řešení však v našem případě není dostatečné. Dalším řešením je vytvořit si \uv{vlastní index} pomocí tabulky nebo si vytvořit další tabulku, kde budeme indexovat druhý parametr (tedy uživatele jako primární klíč) v našem případě (při daném počtu sloupců) se jedná o téměř totožná řešení. 

\begin{lstlisting}[caption={Vytvoření indexovací tabulky},label=CQL11]
CREATE TABLE userstrackingt ( 
item text,
user text,
timestamp timestamp,
PRIMARY KEY (user)
);
\end{lstlisting}

Nyní sice duplikujeme o trochu více dat, než bychom duplikovali pomocí indexu (který indexuje data lokálně), ale nyní se můžeme jednoduše dotazovat na uživateli a předměty bez jakéhokoliv omezení na škálování a rozsah hodnot. 

\section{Ukládání Solr indexu do Cassandry}
Poslední demonstrovaný příklad ukáže použití vyhledávácího systému Solr, který byl popsán v  \ref{solr}. Tento systém indexuje data do lokálního souboru na disku. Fanoušci Cassandry společně s firmou Datastax vytvořili modifikaci, díky níž se index ukládá přímo do Cassandry (lokálně) a data samotná se ukládájí do Cassandry distribuovaně. Výhody tohoto řešení jsou zřejmé. Získáme distribuované vyhledávací řešení se všemi výhodami Cassandry. K datům můžeme přistupovat pomocí, SolR nebo CQL, což zanechává vysokou flexibilitu přístupu k datům. Využití SolR je kompromisem mezi rychlostí Cassandry a Analytickym schopnostem Hadoopu. Patrně největšími benefity je automatické duplikování dat a také automatické indexování dat vložených do Cassandry a také možnost zapisovat na kterýkoliv SolR uzel, címž se minimalizuje problém úzkého hrdla při zápisu do Solr indexu. Příklad poukáže na základní vyhledávací vlastnosti Solr a jeho výhody oproti CQL.


\begin{conclusion}
\input{conclusion.tex}
\end{conclusion}

\nocite{*}
\bibliographystyle{iso690}
\bibliography{mybibliographyfile}

\appendix

\chapter{Seznam použitých zkratek}
% \printglossaries
\begin{description}
	\item[GUI] Graphical user interface
	\item[XML] Extensible markup language
	\item[CQL] Cassandra query language
	\item[SQL] Structured query language
	\item[NoSQL] Not only SQL
\end{description}

\chapter{Scripty použité pro generování dat}
\lstset{language=Ruby}          % Set your language (you can change the language for each code-block optionally)
\begin{lstlisting}[caption={Generování přístupů z Access Logů},label=CQL3]
#!/usr/bin/ruby
users = ["dominik","pepa","kamil","martin","honza","tomas"]
sites = ["www.facebook.com", ...]
file = File.open("cassandra-100000.cql","w");
severity = ["OK","WARNING","DENIED"]

count = 100000
count.times do
  
  date = Time.at(rand * Time.now.to_i).to_i
  user = users.sample
  site = sites.sample
  
  sevrand = rand(100)
  if sevrand < 100 and sevrand > 90
    sev = severity[2]
  elsif sevrand < 90 and sevrand > 70
    sev = severity[1]
  else
    sev = severity[0]
  end
  
  query = "INSERT INTO accesslog_ks.logs(user,date,webpage,severity) VALUES ('#{user}','#{date}','#{site}','#{sev}');";
  file.puts query   
end
\end{lstlisting}
\pagebreak
\begin{lstlisting}[caption={Generování transakčních událostí},label=CQL3]
#!/usr/bin/ruby
users = ["dominik","pepa","kamil","martin","honza","tomas","tereza"]
file = File.open("items.cql","w");

users.each do | user |
  count = rand(100)
  count.times do
    item = rand(100)
    date = Time.at(rand * Time.now.to_i).to_i
    query = "INSERT INTO accesslog_ks.itemstracking(item,user,timestamp) VALUES ('item-#{item}','#{user}','#{date}');";
    file.puts query       
    query = "INSERT INTO accesslog_ks.userstracking(item,user,timestamp) VALUES ('item-#{item}','#{user}','#{date}');";
    file.puts query    
  
  end
end 
\end{lstlisting}

\chapter{Obsah přiloženého CD}

%upravte podle skutecnosti

\begin{figure}
	\dirtree{%
		.1 readme.txt\DTcomment{stručný popis obsahu CD}.
		.1 exe\DTcomment{adresář se spustitelnou formou implementace}.
		.1 src.
		.2 impl\DTcomment{zdrojové kódy implementace}.
		.2 thesis\DTcomment{zdrojová forma práce ve formátu \LaTeX{}}.
		.1 text\DTcomment{text práce}.
		.2 thesis.pdf\DTcomment{text práce ve formátu PDF}.
		.2 thesis.ps\DTcomment{text práce ve formátu PS}.
	}
\end{figure}

\end{document}
